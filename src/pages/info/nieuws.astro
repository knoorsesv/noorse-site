---
import type { EntryFieldTypes } from 'contentful'
import Layout from '../../layouts/Layout.astro'
import { contentfulClient } from '../../lib/contentful'
import { NewsPage } from '../../react/pages'

interface Category {
  contentTypeId: 'categorie'
  fields: {
    naam: EntryFieldTypes.Text
  }
}

interface NewsItem {
  contentTypeId: 'news'
  fields: {
    title: EntryFieldTypes.Text
    body: EntryFieldTypes.RichText
    attachment: EntryFieldTypes.AssetLink
    category: EntryFieldTypes.EntryResourceLink<Category>
  }
}

const newsItems = (
  await contentfulClient.withoutUnresolvableLinks.getEntries<NewsItem>({
    content_type: 'news',
  })
).items.map(({ fields, sys }) => ({
  ...fields,
  createdAt: sys.createdAt,
  category: { naam: fields.category?.fields.naam },
}))
---

<Layout title="Nieuws">
  <NewsPage newsItems={newsItems} />
</Layout>
