---
import type { EntryFieldTypes } from 'contentful'
import Layout from '../../layouts/Layout.astro'
import { contentfulClient } from '../../lib/contentful'
import { NewsPage } from '../../react/pages'
import type { NewsItem } from '../../react/types/news'

interface Category {
  contentTypeId: 'categorie'
  fields: {
    naam: EntryFieldTypes.Text
  }
}

interface ContentfulNewsItem {
  contentTypeId: 'news'
  fields: {
    title: EntryFieldTypes.Text
    inhoud: EntryFieldTypes.Text
    blurb: EntryFieldTypes.Text
    attachment: EntryFieldTypes.AssetLink
    image: EntryFieldTypes.AssetLink
    category: EntryFieldTypes.EntryResourceLink<Category>
  }
}

const newsItems = (
  await contentfulClient.withoutUnresolvableLinks.getEntries<ContentfulNewsItem>(
    {
      content_type: 'news',
    }
  )
).items.map(
  ({ fields, sys }) =>
    ({
      title: fields.title,
      inhoud: fields.inhoud,
      blurb: fields.blurb,
      createdAt: sys.createdAt,
      categoryName: fields.category?.fields.naam || '',
      image: {
        responsiveURL:
          fields.image?.fields.file?.url &&
          `${fields.image?.fields.file?.url.replace('//', 'https://')}?w=300&h=200&fm=jpg&fl=progressive`,
      },
      attachment: [],
    }) satisfies NewsItem
)
---

<Layout title="Info - Nieuws" currentURL={Astro.url}>
  <NewsPage newsItems={newsItems} />
</Layout>
